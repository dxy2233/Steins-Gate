<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 2017/9/12
 * Time: 9:27
 *商家中心
 */
namespace app\modules\shop\controllers;


use common\models\BanquetOrder;
use common\models\Shop;
use yii\db\Query;
use yii\web\Controller;

class CenterController extends \seller\controllers\InitController
    {
    //    return [
    //        'class' => IsLoginController::className()
    //    ]; // TODO: Change the autogenerated stub
    //}{
    //public function behaviors()
    //{
    //    return [
    //        'class' => IsLoginController::className()
    //    ]; // TODO: Change the autogenerated stub
    //}

    public $layout = 'main.tpl';

    //public function __construct ($id, $module, $config = [])
    //{
    //    $module = \Yii::$app->getModule('user');
    //    parent::__construct($id, $module, $config);
    //}

    public function actionIndex (){
        $session = \Yii::$app->session;
        $shop_usermsg = $session->get('seller_msg');
        if($shop_usermsg['shop_id']){
            $date = date('Y-m-d');
            $date_min =strtotime($date);
            $date_max= $date_min+86400;
             $banquet_msg = BanquetOrder::find()->select('sum(order_price*joined_peoples) as total_moeny,count(order_id) as total_order')->where('shop_id='.$shop_usermsg['shop_id'].' and order_status=3 and create_time>'.$date_min.' and create_time<'.$date_max.'')->asArray()->one();
             $shop_name = Shop::find()->select('shop_name')->where('shop_id='.$shop_usermsg['shop_id'].'')->asArray()->one();
        }
        $params['banquet_msg'] = $banquet_msg;
        $params['shop_name'] = $shop_name;
        return $this->render('index.tpl',$params);
    }

    public function actionBuy (){
        var_dump(111);
    }

}